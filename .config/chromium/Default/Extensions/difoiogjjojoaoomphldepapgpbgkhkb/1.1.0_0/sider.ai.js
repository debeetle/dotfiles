"use strict";(()=>{var Ce=Object.create;var le=Object.defineProperty;var Re=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty;var Ne=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ue=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of Ie(t))!Oe.call(e,c)&&c!==r&&le(e,c,{get:()=>t[c],enumerable:!(n=Re(t,c))||n.enumerable});return e};var U=(e,t,r)=>(r=e!=null?Ce(Me(e)):{},Ue(t||!e||!e.__esModule?le(r,"default",{value:e,enumerable:!0}):r,e));var C=Ne((J,me)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof J<"u")t(me);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:J,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=n=>{let c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class d extends WeakMap{constructor(i,g=void 0){super(g),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}let w=o=>o&&typeof o=="object"&&typeof o.then=="function",_=(o,i)=>(...g)=>{n.runtime.lastError?o.reject(new Error(n.runtime.lastError.message)):i.singleCallbackArg||g.length<=1&&i.singleCallbackArg!==!1?o.resolve(g[0]):o.resolve(g)},G=o=>o==1?"argument":"arguments",Pe=(o,i)=>function(l,...u){if(u.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${G(i.minArgs)} for ${o}(), got ${u.length}`);if(u.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${G(i.maxArgs)} for ${o}(), got ${u.length}`);return new Promise((f,A)=>{if(i.fallbackToNoCallback)try{l[o](...u,_({resolve:f,reject:A},i))}catch{l[o](...u),i.fallbackToNoCallback=!1,i.noCallback=!0,f()}else i.noCallback?(l[o](...u),f()):l[o](...u,_({resolve:f,reject:A},i))})},ae=(o,i,g)=>new Proxy(i,{apply(l,u,f){return g.call(u,o,...f)}}),F=Function.call.bind(Object.prototype.hasOwnProperty),z=(o,i={},g={})=>{let l=Object.create(null),u={has(A,a){return a in o||a in l},get(A,a,y){if(a in l)return l[a];if(!(a in o))return;let m=o[a];if(typeof m=="function")if(typeof i[a]=="function")m=ae(o,o[a],i[a]);else if(F(g,a)){let S=Pe(a,g[a]);m=ae(o,o[a],S)}else m=m.bind(o);else if(typeof m=="object"&&m!==null&&(F(i,a)||F(g,a)))m=z(m,i[a],g[a]);else if(F(g,"*"))m=z(m,i[a],g["*"]);else return Object.defineProperty(l,a,{configurable:!0,enumerable:!0,get(){return o[a]},set(S){o[a]=S}}),m;return l[a]=m,m},set(A,a,y,m){return a in l?l[a]=y:o[a]=y,!0},defineProperty(A,a,y){return Reflect.defineProperty(l,a,y)},deleteProperty(A,a){return Reflect.deleteProperty(l,a)}},f=Object.create(o);return new Proxy(f,u)},K=o=>({addListener(i,g,...l){i.addListener(o.get(g),...l)},hasListener(i,g){return i.hasListener(o.get(g))},removeListener(i,g){i.removeListener(o.get(g))}}),_e=new d(o=>typeof o!="function"?o:function(g){let l=z(g,{},{getContent:{minArgs:0,maxArgs:0}});o(l)}),ge=new d(o=>typeof o!="function"?o:function(g,l,u){let f=!1,A,a=new Promise(N=>{A=function(k){f=!0,N(k)}}),y;try{y=o(g,l,A)}catch(N){y=Promise.reject(N)}let m=y!==!0&&w(y);if(y!==!0&&!m&&!f)return!1;let S=N=>{N.then(k=>{u(k)},k=>{let H;k&&(k instanceof Error||typeof k.message=="string")?H=k.message:H="An unexpected error occurred",u({__mozWebExtensionPolyfillReject__:!0,message:H})}).catch(k=>{})};return S(m?y:a),!0}),Ee=({reject:o,resolve:i},g)=>{n.runtime.lastError?n.runtime.lastError.message===t?i():o(new Error(n.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?o(new Error(g.message)):i(g)},ce=(o,i,g,...l)=>{if(l.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${G(i.minArgs)} for ${o}(), got ${l.length}`);if(l.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${G(i.maxArgs)} for ${o}(), got ${l.length}`);return new Promise((u,f)=>{let A=Ee.bind(null,{resolve:u,reject:f});l.push(A),g.sendMessage(...l)})},Se={devtools:{network:{onRequestFinished:K(_e)}},runtime:{onMessage:K(ge),onMessageExternal:K(ge),sendMessage:ce.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:ce.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},L={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":L},services:{"*":L},websites:{"*":L}},z(n,Se,c)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var O=U(C());var je=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),Ye=new Map(je);var et=Symbol(".toJSON was called");var j=U(C()),pe=!/ChatGPT/.test(j.default.runtime.getManifest().name);var de=j.default.runtime.getManifest().version;var ue="https://gochitchat.ai",x={origin:ue,api:`${ue}/api`};var B=(s=>(s.English="en",s["Chinese(Simplified)"]="zh_CN",s["Chinese(Traditional)"]="zh_TW",s.Spanish="es",s.French="fr",s.Japanese="ja",s.German="de",s.Portuguese="pt",s.Arabic="ar",s.Russian="ru",s.Italian="it",s.Korean="ko",s.Hindi="hi",s.Dutch="nl",s.Polish="pl",s.Amharic="am",s.Bulgarian="bg",s.Bengali="bn",s.Catalan="ca",s.Czech="cs",s.Danish="da",s.Greek="el",s.Estonian="et",s.Persian="fa",s.Finnish="fi",s.Filipino="fil",s.Gujarati="gu",s.Hebrew="he",s.Croatian="hr",s.Hungarian="hu",s.Indonesian="id",s.Kannada="kn",s.Lithuanian="lt",s.Latvian="lv",s.Malayalam="ml",s.Marathi="mr",s.Malay="ms",s.Norwegian="no",s.Romanian="ro",s.Slovak="sk",s.Slovenian="sl",s.Serbian="sr",s.Swedish="sv",s.Swahili="sw",s.Tamil="ta",s.Telugu="te",s.Thai="th",s.Turkish="tr",s.Ukrainian="uk",s.Urdu="ur",s.Vietnamese="vi",s))(B||{}),De={en:"English",zh_CN:"\u4E2D\u6587(\u7B80\u4F53)",zh_TW:"\u4E2D\u6587(\u7E41\u9AD4)",es:"Espa\xF1ol",fr:"Fran\xE7ais",ja:"\u65E5\u672C\u8A9E",de:"Deutsch",pt:"Portugu\xEAs",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",it:"Italiano",ko:"\uD55C\uAD6D\uC5B4",hi:"\u0939\u093F\u0928\u094D\u0926\u0940",nl:"Nederlands",pl:"Polski",am:"\u12A0\u121B\u122D\u129B",bg:"\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438",bn:"\u09AC\u09BE\u0982\u09B2\u09BE",ca:"Catal\xE0",cs:"\u010Ce\u0161tina",da:"Dansk",el:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",et:"Eesti",fa:"\u0641\u0627\u0631\u0633\u06CC",fi:"Suomi",fil:"Filipino",gu:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0",he:"\u05E2\u05D1\u05E8\u05D9\u05EA",hr:"Hrvatski",hu:"Magyar",id:"Indonesia",kn:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",lt:"Lietuvi\u0173",lv:"Latvie\u0161u",ml:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02",mr:"\u092E\u0930\u093E\u0920\u0940",ms:"Bahasa Melayu",no:"Norsk",ro:"Rom\xE2n\u0103",sk:"Sloven\u010Dina",sl:"Sloven\u0161\u010Dina",sr:"\u0421\u0440\u043F\u0441\u043A\u0438",sv:"Svenska",sw:"Kiswahili",ta:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD",te:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",th:"\u0E44\u0E17\u0E22",tr:"T\xFCrk\xE7e",uk:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",ur:"\u0627\u0631\u062F\u0648",vi:"Ti\u1EBFng Vi\u1EC7t"},it=Object.entries(B).reduce((e,[t,r])=>(e[r]=t,e),{}),at=Object.entries(B).map(([e,t])=>({label:e,value:t})),gt=Object.entries(De).map(([e,t])=>({label:t,value:e}));async function fe(){let{provider:e="siderApi"}=await j.default.storage.local.get("provider"),t="provider:gpt3",r=await j.default.storage.local.get(t);return{provider:e,configs:{["gpt3"]:r[t]}}}var ct={pricing:`${x.origin}/pricing`,login:`${x.origin}/login`,myChats:`${x.origin}/mychats`,openaiChat:"https://chat.openai.com",openaiLogin:"https://platform.openai.com/login",openaiSignup:"https://platform.openai.com/signup",openaiApiKey:"https://platform.openai.com/account/api-keys",openaiApiSession:"https://chat.openai.com/api/auth/session",edgeStore:"https://microsoftedge.microsoft.com/addons/detail/sider-ai-sidebar/dhoenijjpgpeimemopealfcbiecgceod",chromeStoreReview:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb/reviews",chromeStore:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb",weChatQrCode:"https://gochitchat.ai/resource/weixin/qrcode.jpeg",producthuntPromoteApi:"https://gochitchat.ai/resource/promotion/extension-promote.json"};var ie=U(C());var h=U(C());function T(e){return h.default.storage.local.get(e)}async function E(e){return h.default.storage.local.set(e)}async function Ae(e){return new Promise(t=>{T({[e]:""}).then(r=>{if(r[e]){t(r[e]);return}function n(c){c[e]?.newValue&&(t(c[e]?.newValue),h.default.storage.local.onChanged.removeListener(n))}h.default.storage.local.onChanged.addListener(n)})})}async function R(e){return h.default.storage.local.remove(e)}async function q(e){if(h.default?.cookies){let t=await h.default.cookies.get(e);return t?.value?decodeURIComponent(t.value):null}return h.default.runtime.sendMessage({type:"GET_COOKIE",data:e})}async function Y(e){return h.default?.cookies?await h.default.cookies.set(e):h.default.runtime.sendMessage({type:"SET_COOKIE",data:e})}var W,$e=new Uint8Array(16);function Z(){if(!W&&(W=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!W))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return W($e)}var p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function ye(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}var Ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),X={randomUUID:Ve};function Ge(e,t,r){if(X.randomUUID&&!t&&!e)return X.randomUUID();e=e||{};let n=e.random||(e.rng||Z)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let c=0;c<16;++c)t[r+c]=n[c];return t}return ye(n)}var ee=Ge;var he=U(C());async function I(){let{generatedRandomId:e}=await T({generatedRandomId:""});if(!e){let t=await Fe();return t||(t=ee(),ze(t)),he.default.storage.local.set({generatedRandomId:t}),t}return e}var xe=x.origin.replace(/\/\/\w+?\./,"//Y2hhdGdwdC1zaWRlYmFy."),be="zgv2awnlswq";async function Fe(){try{return await q({url:xe,name:be})}catch{return""}}async function ze(e){let t=Math.round(Date.now()/1e3)+31104e3;try{return await Y({url:xe,name:be,value:e,expirationDate:t,secure:!0})}catch{}}var te=(...e)=>e.join("/").replace(/([^:])\/{2,}/g,"$1/");function we(e=1e3){return new Promise(t=>{setTimeout(()=>{t()},e)})}async function D(e,t=1e3,r=2){let n=0;for(;;){try{return await e()}catch(c){if(r>=0&&n++>=r)throw c}await we(t)}}function re(e,t=0){let r=!1,n;return(...c)=>(r||(r=!0,n=new Promise((d,w)=>{e(...c).then(_=>{d(_)}).catch(_=>{w(_)}).finally(async()=>{t&&await we(t),r=!1})})),n)}var v=`ChitChat_${pe?"Edge":"Chrome"}_Ext`,$=de,qe=Intl.DateTimeFormat().resolvedOptions().timeZone,ke={async refreshToken(e){let t=await b("/v1/user/token/refresh",{refresh_token:e},{headers:{Authorization:""}});return{token:t.token.token,refreshToken:t.token.refresh_token}},getSiderAnonymousToken:re(async()=>{let e=await I();return b("/v1/user/login/device_id",{device_id:e,uuid:e,app_name:v,app_version:$},{headers:{Authorization:""}})}),getVipInfo:re(async()=>{let e;try{if(e=await M(`/v1/completion/limit?app_name=${v}&tz_name=${qe}`),!e.chat.count)throw E({ERR_MUST_LOGIN:!0}),new Error("wrong_data");R("ERR_VIP_LIMIT")}catch(n){throw n.message!=="wrong_data"&&E({ERR_VIP_LIMIT:!0}),n}let t=e.chat_period_info[e.user_type],r={isVIP:e.user_type==="premium",total:e.chat.count,remain:e.chat.remain,maxToken:t?.prompt_max_token,award:{device:{count:e.chat_period_info.device.count},login:{count:e.chat_period_info.login.count},premium:{count:e.chat_period_info.premium.count}}};return Te(r),r},5e3),async getUserSettings(){return(await M(`/v1/user/settings?app_name=${v}`)).client_setting},setUserSettings(e){return D(()=>b("/v1/user/settings",{app_name:v,client_setting:e}))},getUserPromptList(e){return M(`/v1/prompt/list?type=${e}&page_size=999`)},createUserPrompt(e){return D(()=>b("/v1/prompt/create",{is_template:!1,...e}))},editUserPrompt(e){return D(()=>b("/v1/prompt/edit",e))},delUserPrompt(e){return D(()=>b("/v1/prompt/update",{id:e,status:"Deleted"}))},async uploadHistoryMsg(e){return(await b("/v1/conversation/upload",{app_name:v,app_version:$,messages:e})).cid},uploadConversion(e){return b("/v1/conversation/upload",{share:!0,app_name:v,app_version:$,messages:e})},saveConversion(e){return b("/v1/conversation/upload",{save_by_user:!0,app_name:v,app_version:$,messages:e})},async shareConversion(e){return(await M(`/v1/conversation/share/${e}`)).share_key},saveSiderConversion(e){return M(`/v1/conversation/save-by-user/${e}`)},unSaveSiderConversion(e){return M(`/v1/conversation/unsave-by-user/${e}`)},delConversion(e){return We(`/v1/conversation/delete/${e}`)},async sendFeedback({title:e,detail:t,email:r}){let n=await se();return b("/v1/app/feedback",{title:e,email:r,data:{detail:t},app_name:v,app_version:$},{headers:{Authorization:n?.token||""}})}};async function ne(e,t=null,r={}){e.startsWith("http")||(e=te(x.api,e)),r.headers||(r.headers={});let n="";"Authorization"in r.headers||(n=(await V()).token);let c={"Content-Type":"application/json",Authorization:n};if(r.headers={...c,...r.headers},t)try{r.body=JSON.stringify(t)}catch{r.body=t}let d=await fetch(e,r),w=await d.json();return R("ERR_MUST_LOGIN"),!d.ok||w.code!==0?((w.code===1003||w.code===1006)&&E({ERR_MUST_LOGIN:!0}),Promise.reject(w)):w.data}function M(e,t=null,r={}){return ne(e,t,{method:"GET",...r})}function b(e,t=null,r={}){return ne(e,t,{method:"POST",...r})}function We(e,t=null,r={}){return ne(e,t,{method:"DELETE",...r})}async function Qe(){let e=await oe("userinfo-type");return!!(e&&e!=="device")}async function Ke(){let{vipInfo:e}=await T({vipInfo:{isVIP:!1,remain:0,total:0}});return e}async function Te(e){let t=await Ke();return E({vipInfo:{...t,...e}})}async function V(){let e=await se();return e?{...e,anonymous:!1}:(e=await Le(),{...e,anonymous:!0})}async function se(){if(await Qe()){let e=await oe("token"),t=await oe("refresh_token");return e?{token:e,refreshToken:t}:null}return null}async function Le(){let e=await ve();if(e)return e;let{__getSiderAnonymousToken__:t}=await T({__getSiderAnonymousToken__:!1});if(t)await Ae("siderApiToken"),e=await ve();else{E({__getSiderAnonymousToken__:!0});try{let r=await ke.getSiderAnonymousToken();e={token:r.token.token,refreshToken:r.token.refresh_token}}catch(r){throw R("__getSiderAnonymousToken__"),r}R("__getSiderAnonymousToken__"),He(e)}return e}async function He(e){return ie.default.storage.local.set({siderApiToken:e.token,siderApiRefreshToken:e.refreshToken})}async function ve(){let{siderApiToken:e,siderApiRefreshToken:t}=await ie.default.storage.local.get(["siderApiToken","siderApiRefreshToken"]);return e?{token:e,refreshToken:t}:null}async function oe(e){try{return await q({name:e,url:x.origin})}catch{return(await T({[e]:""}))[e]}}var P={};function Q(e){let t=new CustomEvent("web-response",{detail:e});window.dispatchEvent(t)}Q({type:"loaded"});window.addEventListener("web-request",async e=>{if(location.origin!==x.origin&&!(location.protocol=="chrome-extension:"||location.hostname==="localhost"))return;let t=e.detail,r;switch(t.type){case"chat":{let n=O.default.runtime.connect();P[t.data.originId]=n;let c=d=>{Q(d),d.type=="chat-answer-end"&&(n.disconnect(),delete P[d.data.originId])};n.onMessage.addListener(c),n.postMessage({type:"chat",data:t.data});return}case"chat-abort":{try{P[t.data].disconnect(),delete P[t.data],r={success:!0}}catch(n){r={success:!1,error:n.toString()}}break}}switch(t.type){case"chat":{let n=O.default.runtime.connect();P[t.data.originId]=n;let c=d=>{Q(d),d.type=="chat-answer-end"&&(n.disconnect(),delete P[d.data.originId])};n.onMessage.addListener(c),n.postMessage({type:"chat",data:t.data});return}case"chat-abort":{try{P[t.data].disconnect(),delete P[t.data],r={success:!0}}catch(n){r={success:!1,error:n.toString()}}break}}switch(t.type){case"get-token":{let n=await V();r={token:n.token,refreshToken:n.refreshToken};break}case"get-device_id":{r=await I();break}case"get-userinfo":{let n=await V();r={token:n.token,refreshToken:n.refreshToken,clientId:await I()};break}case"get-setting-lang":r=await T({language:"en"});break;case"pricing":{O.default.runtime.sendMessage({type:"REFRESH_VIP_INFO"});break}case"open-options":{O.default.runtime.sendMessage({type:"OPEN_OPTIONS_PAGE"});break}case"chat-get-chatGPT-models":{r=await O.default.runtime.sendMessage({type:"chat-get-chatGPT-models"});break}case"chat-get-provider-type":{r=await(await fe()).provider;break}}Q({type:t.type,data:r})});})();
